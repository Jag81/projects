<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta name="description" content="">
        <meta name='viewport' content='width=device-width, initial-scale=1'>
        <link rel="icon" href="data:,">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.css" />
        <script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-3.4.1.min.js"></script>
    </head>
    <body>
        <!----------------------------------------------->
        <div id=layout>
            <div id=header></div>
            <div id=content></div>
            <div id=footer></div>
        </div>
        <!----------------------------------------------->
        <script>
            //------------------------------------
            $vm={};$vm.ver=[0.01,0.01];
            $vm.hosting_path=window.location.href.substring(0, window.location.href.split('?')[0].lastIndexOf('/'));
            if(window.location.hostname=='127.0.0.1' || window.location.hostname=='localhost') $vm.localhost=true;
            //------------------------------------
            var _id=1;
            var hosting_path=window.location.href.substring(0, window.location.href.split('?')[0].lastIndexOf('/'));
            $.get(hosting_path+"/a/header.html",function(code){ $('#header').html(code.replace(/__ID/g, (_id++).toString())); },'text');
            $.get(hosting_path+"/a/footer.html",function(code){ $('#footer').html(code.replace(/__ID/g, (_id++).toString())); },'text');
            $.get(hosting_path+"/b/home.html",function(code){ $('#content').html(code.replace(/__ID/g, (_id++).toString())); },'text');





            
            //------------------------------------
            //Do not need to chang the following code in most cases
            //The following code will load a framework module and on demand module list
            //------------------------------------
            $VmAPI={};$vm.start_time=new Date().getTime();
            //------------------------------------
            $vm.root_layout_header='header';
            $vm.root_layout_content_slot='content'
            $vm.root_layout_footer='footer';
            $vm.root_layout_system='system';
            //---------------------------------------------
            $vm._I=0; $vm._N=$vm.start_modules.length;
            $vm._boot=function(){
                $vm._I++;
                if($vm._I==$vm._N){
                    $vm._start();
                }
            }
            //------------------------------------------
            $vm._J=0; $vm._JN=$vm.app_modules.length;
            $vm._boot2=function(){
                $vm._J++;
                if($vm._J==$vm._JN){
                    console.log("module list is ready  "+(new Date().getTime()-$vm.start_time)+'ms');
                    $vm.all_module=1;
                }
            }
            //------------------------------------------
            $vm._id=1;
            //---------------------------------------------
            var apppath=window.location.href.substring(0, window.location.href.lastIndexOf('/')).split('\/?')[0];
            console.log("start point  "+(new Date().getTime()-$vm.start_time)+'ms');
            $($vm.start_modules).each(function(index,url){
                var ver=localStorage.getItem(apppath+url+"ver");
                var txt=localStorage.getItem(apppath+url+"txt");
                if(ver!=$vm.ver[0] || txt==null || $vm.localhost==true){
                    $.get(url+'?_='+new Date().getTime(),function(new_txt){
                        localStorage.setItem(apppath+url+"txt",new_txt);
                        localStorage.setItem(apppath+url+"ver",$vm.ver[0]);
                        console.log('loading from url, done at '+(new Date().getTime()-$vm.start_time)+'ms. '+url );
                        $('#system').append(new_txt.replace(/__ID/g,'_'+(index+1)));
                        $vm._boot();
                    },'text');
                }
                else{
                    console.log('loading from storage. done at '+(new Date().getTime()-$vm.start_time)+'ms. '+url+' '+ver+'/'+$vm.ver[0]);
                    $('#system').append(txt.replace(/__ID/g,'_'+(index+1)));
                    $vm._boot();
                }
            })
            //---------------------------------------------
            //(delayed) load module-list js and run;
            setTimeout(function (){
                var T=0;
                $($vm.app_modules).each(function(index,url){
                    T+=10;
                    setTimeout(function (){
                        var ver=localStorage.getItem(apppath+url+"ver");
                        var txt=localStorage.getItem(apppath+url+"txt");
                        if(ver!=$vm.ver[0] || txt==null || $vm.localhost==true){
                            $.get(url+'?_='+new Date().getTime(),function(new_txt){
                                localStorage.setItem(apppath+url+"txt",new_txt);
                                localStorage.setItem(apppath+url+"ver",$vm.ver[0]);
                                console.log('loading from url, done at '+(new Date().getTime()-$vm.start_time)+'ms. '+url);
                                eval(new_txt);
                                $vm._boot2();
                            },'text');
                        }
                        else{
                            console.log('loading from storage, done at '+(new Date().getTime()-$vm.start_time)+'ms. '+url+' '+ver+'/'+$vm.ver[0]);
                            eval(txt);
                            $vm._boot2();
                        }
                    },10+T);
                })
            },10);
            //---------------------------------------------
        </script>
        <!----------------------------------------------->
        <style>
            html,body{
                margin:0;
                padding:0;
                height:100%;
                font-family:Arial;
            }
            body{
                background-size: cover; background-repeat: repeat-x; background-position: center top; background-attachment: fixed;
                background-image: url(https://images.unsplash.com/photo-1523428096881-5bd79d043006?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1350&q=80);
            }
            /*setup the layout*/
            #layout {
                height: 100%;
                display: grid;
                grid-template-rows: auto 1fr auto;
                overflow:hidden;
            }
        </style>
        <!----------------------------------------------->
    </body>
</html>

